---
const steps = [
  {
    id: "sign",
    number: "01",
    title: "Sign",
    description:
      "The client signs with their wallet the request details — method, URL, headers, body, etc."
  },
  {
    id: "send",
    number: "02",
    title: "Send",
    description:
      "The signed request is sent to the server, with the Ethereum address and signature attached."
  },
  {
    id: "verify",
    number: "03",
    title: "Verify",
    description:
      "The server validates the signature and authenticates the request."
  }
]
---

<section class="relative overflow-hidden border-b border-border px-4 py-24 md:px-12 md:py-32">
  <!-- Grid background -->
  <div class="absolute inset-0 opacity-10 pointer-events-none bg-grid"></div>
  
  <div class="max-w-7xl mx-auto relative z-10">
    <div class="mb-16 md:mb-20">
      <div class="text-xl font-bold uppercase tracking-[0.15em] flex items-center gap-4">
        <span class="block w-4 h-4 bg-white"></span>
        Request Lifecycle
      </div>
    </div>

    <div class="relative grid grid-cols-1 md:grid-cols-3 gap-16 md:gap-0">
      <!-- Flowing connection line (desktop only) -->
      <svg class="connection-flow hidden md:block absolute top-[120px] left-[16.67%] w-[66.67%] h-8 z-0" viewBox="0 0 800 32" preserveAspectRatio="none">
        <line x1="0" y1="16" x2="800" y2="16" stroke="rgba(255,255,255,0.05)" stroke-width="0.5"/>
        <circle class="flow-particle flow-particle-1" cx="0" cy="16" r="1" fill="white" opacity="0"/>
        <circle class="flow-particle flow-particle-2" cx="0" cy="16" r="1" fill="white" opacity="0"/>
      </svg>
      
      {
        steps.map((step, i) => (
          <div class={`relative group z-10 ${i < steps.length - 1 ? 'md:border-r md:border-white/[0.05]' : ''}`}>
            <div class="md:px-8 lg:px-12">
              <!-- Step number -->
              <div class="mb-6 font-mono text-[11px] tracking-[0.2em] uppercase opacity-20">{step.number}</div>
              
              <!-- Illustration container -->
              <div class="illustration-container relative h-48 md:h-52 mb-10 flex items-center justify-center">
                
                {step.id === "sign" && (
                  <div class="sign-illustration relative w-full h-full">
                    <svg class="w-full h-full" viewBox="0 0 240 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <!-- Document — centered, refined -->
                      <g class="sign-doc">
                        <rect x="56" y="24" width="104" height="136" rx="3" stroke="white" stroke-width="0.8" opacity="0.35"/>
                        <!-- Page fold -->
                        <path d="M132 24V46H156" stroke="white" stroke-width="0.5" opacity="0.15" fill="none"/>
                        <!-- Content lines -->
                        <line x1="76" y1="60" x2="140" y2="60" stroke="white" stroke-width="0.5" opacity="0.12" stroke-linecap="round"/>
                        <line x1="76" y1="72" x2="128" y2="72" stroke="white" stroke-width="0.5" opacity="0.09" stroke-linecap="round"/>
                        <line x1="76" y1="84" x2="136" y2="84" stroke="white" stroke-width="0.5" opacity="0.12" stroke-linecap="round"/>
                        <line x1="76" y1="96" x2="116" y2="96" stroke="white" stroke-width="0.5" opacity="0.07" stroke-linecap="round"/>
                        <!-- Divider -->
                        <line x1="76" y1="118" x2="140" y2="118" stroke="white" stroke-width="0.3" opacity="0.06"/>
                        <!-- Signature -->
                        <path class="sign-signature" d="M76 138 C88 124, 96 148, 108 134 C116 126, 124 142, 136 132" stroke="white" stroke-width="1.2" stroke-linecap="round" fill="none"/>
                      </g>

                      <!-- Subtle wave accent — just a hint of cryptography -->
                      <path class="sign-wave" d="M44 176 C72 168, 96 184, 120 176 C144 168, 168 184, 196 176" stroke="white" stroke-width="0.4" stroke-linecap="round" fill="none" opacity="0"/>
                    </svg>
                  </div>
                )}
                
                {step.id === "send" && (
                  <div class="send-illustration relative w-full h-full">
                    <svg class="w-full h-full" viewBox="0 0 240 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <!-- Signed document (compact) -->
                      <g class="send-doc">
                        <rect x="12" y="52" width="56" height="76" rx="3" stroke="white" stroke-width="0.7" opacity="0.3"/>
                        <!-- Content lines -->
                        <line x1="24" y1="70" x2="56" y2="70" stroke="white" stroke-width="0.4" opacity="0.1" stroke-linecap="round"/>
                        <line x1="24" y1="80" x2="48" y2="80" stroke="white" stroke-width="0.4" opacity="0.08" stroke-linecap="round"/>
                        <line x1="24" y1="90" x2="52" y2="90" stroke="white" stroke-width="0.4" opacity="0.1" stroke-linecap="round"/>
                        <!-- Mini signature -->
                        <path d="M24 108 C30 102, 36 112, 42 106 C48 100, 54 110, 60 104" stroke="white" stroke-width="0.7" stroke-linecap="round" fill="none" opacity="0.2"/>
                      </g>

                      <!-- Transmission path -->
                      <g class="send-path">
                        <line x1="80" y1="90" x2="152" y2="90" stroke="white" stroke-width="0.3" opacity="0.05"/>
                        <!-- Two data packets -->
                        <circle class="pkt pkt-1" r="2.5" fill="white" opacity="0">
                          <animateMotion dur="3s" repeatCount="indefinite" path="M80 90 L152 90"/>
                        </circle>
                        <circle class="pkt pkt-2" r="2" fill="white" opacity="0">
                          <animateMotion dur="3s" repeatCount="indefinite" begin="1.2s" path="M80 90 L152 90"/>
                        </circle>
                      </g>

                      <!-- Server (simplified) -->
                      <g class="send-server">
                        <rect x="160" y="36" width="64" height="108" rx="3" stroke="white" stroke-width="0.8" opacity="0.35"/>
                        <!-- Dividers -->
                        <line x1="160" y1="72" x2="224" y2="72" stroke="white" stroke-width="0.3" opacity="0.06"/>
                        <line x1="160" y1="108" x2="224" y2="108" stroke="white" stroke-width="0.3" opacity="0.06"/>
                        <!-- Status LEDs -->
                        <circle class="led led-1" cx="212" cy="54" r="2" fill="white" opacity="0.08"/>
                        <circle class="led led-2" cx="212" cy="90" r="2" fill="white" opacity="0.08"/>
                        <circle class="led led-3" cx="212" cy="126" r="2" fill="white" opacity="0.08"/>
                      </g>
                    </svg>
                  </div>
                )}
                
                {step.id === "verify" && (
                  <div class="verify-illustration relative w-full h-full">
                    <svg class="w-full h-full" viewBox="0 0 240 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <!-- Single verification ring -->
                      <circle class="v-ring" cx="120" cy="84" r="56" stroke="white" stroke-width="0.4" fill="none" opacity="0"/>
                      
                      <!-- Shield -->
                      <g class="v-shield">
                        <path class="shield-draw" d="M120 22L76 42V84C76 114 94 138 120 150C146 138 164 114 164 84V42L120 22Z" stroke="white" stroke-width="0.8" fill="none"/>
                      </g>

                      <!-- Checkmark -->
                      <path class="v-check" d="M104 84L114 96L140 66" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>

                      <!-- Address -->
                      <g class="v-address">
                        <rect class="addr-pill" x="52" y="166" width="136" height="24" rx="12" stroke="white" stroke-width="0.5" fill="none" opacity="0"/>
                        <text class="addr-text" x="120" y="182" font-family="'SF Mono', 'Fira Code', 'Cascadia Code', monospace" font-size="10" fill="white" text-anchor="middle" letter-spacing="0.5" opacity="0">0x71C7...d93A</text>
                      </g>
                    </svg>
                  </div>
                )}
              </div>
              
              <div class="md:text-left">
                <h3 class="text-lg font-bold uppercase mb-3 tracking-wide">{step.title}</h3>
                <p class="text-[15px] opacity-50 leading-[1.75] max-w-xs">{step.description}</p>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  .bg-grid {
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
    background-size: 40px 40px;
  }

  /* ═══════════════════════════════════════════════════════════
     CONNECTION PARTICLES
     ═══════════════════════════════════════════════════════════ */
  
  .flow-particle-1 { animation: flow-drift 6s cubic-bezier(0.4, 0, 0.2, 1) infinite; }
  .flow-particle-2 { animation: flow-drift 6s cubic-bezier(0.4, 0, 0.2, 1) infinite 2.5s; }

  @keyframes flow-drift {
    0%   { cx: 0; opacity: 0; }
    5%   { opacity: 0.3; }
    95%  { opacity: 0.3; }
    100% { cx: 800; opacity: 0; }
  }

  /* ═══════════════════════════════════════════════════════════
     SIGN – Document + subtle wave
     ═══════════════════════════════════════════════════════════ */

  .sign-illustration .sign-signature {
    stroke-dasharray: 120;
    stroke-dashoffset: 120;
    animation: sig-write 6s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  }

  @keyframes sig-write {
    0%, 10% { stroke-dashoffset: 120; opacity: 0; }
    18%     { opacity: 0.7; }
    50%     { stroke-dashoffset: 0; opacity: 0.7; }
    80%     { stroke-dashoffset: 0; opacity: 0.45; }
    100%    { stroke-dashoffset: 0; opacity: 0.15; }
  }

  .sign-illustration .sign-wave {
    stroke-dasharray: 200;
    stroke-dashoffset: 200;
    animation: wave-draw 6s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  }

  @keyframes wave-draw {
    0%, 40%  { stroke-dashoffset: 200; opacity: 0; }
    50%      { opacity: 0.12; }
    70%      { stroke-dashoffset: 0; opacity: 0.12; }
    90%      { stroke-dashoffset: 0; opacity: 0; }
    100%     { stroke-dashoffset: 0; opacity: 0; }
  }

  .sign-illustration .sign-doc {
    animation: gentle-float 8s ease-in-out infinite;
  }

  /* ═══════════════════════════════════════════════════════════
     SEND – Document → Server
     ═══════════════════════════════════════════════════════════ */

  .send-illustration .pkt-1 { animation: pkt-fade 3s ease-in-out infinite; }
  .send-illustration .pkt-2 { animation: pkt-fade 3s ease-in-out infinite 1.2s; }

  @keyframes pkt-fade {
    0%   { opacity: 0; }
    10%  { opacity: 0.2; }
    85%  { opacity: 0.2; }
    100% { opacity: 0; }
  }

  .send-illustration .led-1 { animation: led-blink 3s ease-in-out infinite; }
  .send-illustration .led-2 { animation: led-blink 3s ease-in-out infinite 0.5s; }
  .send-illustration .led-3 { animation: led-blink 3s ease-in-out infinite 1s; }

  @keyframes led-blink {
    0%, 100% { opacity: 0.06; }
    50%      { opacity: 0.35; }
  }

  .send-illustration .send-doc {
    animation: gentle-float 8s ease-in-out infinite;
  }

  /* ═══════════════════════════════════════════════════════════
     VERIFY – Shield + Check + Address
     ═══════════════════════════════════════════════════════════ */

  .verify-illustration .shield-draw {
    stroke-dasharray: 360;
    stroke-dashoffset: 360;
    animation: shield-trace 6s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  }
  @keyframes shield-trace {
    0%       { stroke-dashoffset: 360; opacity: 0.15; }
    10%      { opacity: 0.6; }
    40%      { stroke-dashoffset: 0; opacity: 0.6; }
    80%      { stroke-dashoffset: 0; opacity: 0.4; }
    100%     { stroke-dashoffset: 0; opacity: 0.15; }
  }

  .verify-illustration .v-check {
    stroke-dasharray: 60;
    stroke-dashoffset: 60;
    animation: check-snap 6s cubic-bezier(0.16, 1, 0.3, 1) infinite;
  }
  @keyframes check-snap {
    0%, 36%  { stroke-dashoffset: 60; opacity: 0; }
    40%      { opacity: 0.9; }
    52%      { stroke-dashoffset: 0; opacity: 0.9; }
    80%      { stroke-dashoffset: 0; opacity: 0.6; }
    100%     { stroke-dashoffset: 0; opacity: 0.15; }
  }

  .verify-illustration .v-ring {
    animation: ring-out 6s cubic-bezier(0.16, 1, 0.3, 1) infinite;
    transform-origin: 120px 84px;
  }
  @keyframes ring-out {
    0%, 42%  { opacity: 0; transform: scale(0.85); }
    56%      { opacity: 0.1; transform: scale(1); }
    78%      { opacity: 0.05; transform: scale(1.06); }
    100%     { opacity: 0; transform: scale(1.1); }
  }

  .verify-illustration .addr-pill {
    animation: pill-reveal 6s cubic-bezier(0.16, 1, 0.3, 1) infinite;
  }
  @keyframes pill-reveal {
    0%, 52%   { opacity: 0; }
    64%       { opacity: 0.3; }
    82%       { opacity: 0.3; }
    100%      { opacity: 0; }
  }

  .verify-illustration .addr-text {
    animation: text-reveal 6s cubic-bezier(0.16, 1, 0.3, 1) infinite;
  }
  @keyframes text-reveal {
    0%, 54%   { opacity: 0; }
    66%       { opacity: 0.5; }
    82%       { opacity: 0.5; }
    100%      { opacity: 0; }
  }

  /* ═══════════════════════════════════════════════════════════
     SHARED
     ═══════════════════════════════════════════════════════════ */

  @keyframes gentle-float {
    0%, 100% { transform: translateY(0); }
    50%      { transform: translateY(-1.5px); }
  }

  /* ═══════════════════════════════════════════════════════════
     HOVER
     ═══════════════════════════════════════════════════════════ */

  .illustration-container {
    transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .group:hover .illustration-container {
    transform: scale(1.03);
  }

  .illustration-container svg {
    transition: filter 0.6s ease;
  }

  .group:hover .illustration-container svg {
    filter: drop-shadow(0 0 20px rgba(255,255,255,0.04));
  }

  /* ═══════════════════════════════════════════════════════════
     RESPONSIVE
     ═══════════════════════════════════════════════════════════ */
  
  @media (max-width: 767px) {
    .illustration-container {
      height: 11rem;
    }
  }
</style>
